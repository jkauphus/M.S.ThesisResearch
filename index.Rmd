---
title: Habitat Selection by Cottonmouths (Agkistrodon piscivorus) in Middle Tennessee.-
  Preliminary Anlysis
author: "Jack Kauphusman"
date: "10/23/2019"
output:
  html_notebook:
    df_print: paged
    highlight: breezedark
    number_sections: yes
    rows.print: 10
    theme: cosmo
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  html_document:
    df_print: paged
    toc: yes
  pdf_document: default
editor_options:
  chunk_output_type: inline
---
<style type="text/css">

h1.title {
  font-size: 40px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}
h4.author { /* Header 4 - and the author and data headers use this too  */
  font-size: 20px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}
</style>
---


```{r Library, include=FALSE}
library("dplyr")
library("ggplot2")
library("factoextra")
library("FactoMineR")
library("tidyr")
library("knitr")
library("gridExtra")
library(lattice)
library(permute)
library(vegan)
library(RVAideMemoire)
library(MASS)
library(caret)
library(tmap)
library(tmaptools)
library("ggsn")
library("leaflet")
library("mapdata")
library("maptools")
library("rgdal")
library("smoothr")
library("sf")
library("sp")
library(ggmap)
library("tidyverse")
library(gridExtra)
```

# Methodology

## Study Area 

Data was collected along the Cumberland River Bicentennial Trail (CRBT), Cheatham County, Tennessee, USA (36˚17’ N, 87˚05’W). A boundary of an 115ha area was constructed using ArcMap (ESRI Products) to be used as the focal study area and the habitats within to be assessed. The trail was included within the boundary and divided the mixed lowland forest and slough wetlands from the upland limestone bluffs and rocky outcrops. Cottonmouths used the upland forest and limestone bluffs as overwintering sites and occupied the lowland forest slough during the active season. The landscape features that bordered the study area were the limestone bluffs and backwater streams along the northern portions, the Cumberland River along the west and south, and crop fields and urban development along the southern portions. These landscape features appeared to isolate this population of cottonmouths from dispersal. Unpublished telemetry data (Smith 2009) noted that snakes did not leave the study area, however, an adult male was observed attempting to cross a road toward the Cumberland River but was unfortunately killed by a passing vehicle.  

The habitat types found within the study area are the buttonbush slough in the central portion (xx ha), characterized by relatively open canopy, deeper water (50-150 cm), and mats of floating vegetation (Hydrocotyle ranunculoides & Ludwigia palustris) scattered throughout the slough. An open water habitat (> 100cm) is located toward the western portion of the study area. The seasonally flooded lowland forest (xx ha), dominated by red maples (Acer rubrum), has the denser canopy closure for the wetland, and is located between the slough and upland forest. Toward the southern portion between the slough and crop fields is a transitional edge area (xx ha) dominated by dense grass vegetation and occasionally floods (<10cm) in some portions throughout the year.  The upland forest habitat (xx ha) was dominated by oak trees (Quercus sp.) and had dense canopy closure and higher percentage of bare soil. Three main streams flow into the slough from the upland forest and provide a permanent source of water to the slough, along with periodic flooding from the Cumberland River, and groundwater seepage. A constructed levee divides the slough from adjacent crop fields, and during the fall waterfowl hunt, a culvert is opened from the levee to reduce the flooded areas.  

```{r Field Map, echo=TRUE, message=FALSE, warning=FALSE}
#Outmap
state <- map_data("state")
county <- map_data("county")
study_site <- data.frame("x" = -87.092447, "y" = 36.288684)
tn <- county %>% 
  filter(region=="tennessee")

Cheatham <- county %>% 
  filter(region=="tennessee") %>% 
  filter(subregion=="cheatham")

a1<-ggplot() + geom_polygon(data = state, aes(x=long, y = lat, group = group),
                        fill = "white", color="black") + 
           geom_polygon(data = tn, aes(x=long, y = lat, group = group),
                        fill = "gray", color="black") + 
           geom_polygon(data = Cheatham, aes(x=long, y = lat, group = group),
                        fill = "yellow", color="black") + 
           geom_point(data = study_site, aes(x=x,y=y), color="black") +
  coord_fixed(xlim = c(-91, -81),  ylim = c(34, 37), ratio = 1.2) + 
  xlab("Longitude") + ylab("Latitude") + ggtitle("Cheatham Co., TN")
```

```{r Files, include=FALSE}
#Using ggspatial
library(ggspatial)
library(rosm)

#Shapefiles
generalhab<-st_read("data/Habitat/GENERALHABITAT.shp")
Boundary<-st_read("data/Habitat/GENRLHABI.shp")
cottonmouths<-st_read("data/Habitat/Cottonmouths.shp")
```


```{r Study Site Static, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE}
#Map
b<-ggplot()+
  annotation_map_tile(type = "thunderforestlandscape")+
  annotation_scale(location = "bl")+
  geom_sf(data = Boundary,size = 1, col = "red", fill = NA, show.legend = "line")+
  geom_sf(data = cottonmouths, aes(fill = "Cottonmouth Location"),col = "purple",size = 1.5, show.legend = "point")+
  labs(fill = 'Legend', title = "Study Site")
grid.arrange(a1,b, ncol=1)
```
**Map 1:** Above, location of the study site along a swamp adjacent to The Cumberland River Bicentennial Trail, Cheatham County, TN, USA. Below,is the zoomed in view of the study area. The boundary line, where collection took place, is colored in red, and the cottonmouth locations were symbolized as green points. 

```{r Study Site, echo=TRUE, message=FALSE, warning=FALSE}
a<-tmap_mode("view")+
tm_shape(Boundary)+
  tm_borders(col= "red", lwd = 1)+
  tm_shape(cottonmouths)+
  tm_dots(col = "purple", size = 0.05, id = "NAME", text = "Cottonmouth location")+
  tm_scale_bar()+
  tm_layout("Study Site", legend.show = T)+
  tm_basemap(leaflet::providers$Esri.WorldImagery)
a
```
**Map 2:** The interactive map of the study area, made using the tmap package.


## Field Collection 

Visual encounter surveys occurred during the active seasons (May – October) of 2012, 2013, and 2019. Snakes were captured using snake tongs and retained in plastic restraining tubes (Midwest Tongs).  For individual identification, each snake was implanted subcutaneously with a Passive Integrated Transponder (PIT) tag (Biomark) on the posterior to the ventral side of the midbody. Tags and implant syringes were soaked in Benzalkonium Chloride (Benz-all) for 2 – 3 minutes prior to tag implantation, and an antiseptic liquid bandage (Vetclose) was applied to the insertion area to facilitate healing. Snout-vent length (SVL) and tail lengths (TL) were measured, and snakes were sexed by either everting hemipenes or by probing (Blanchard, F and Finister, E 1933) Individuals were considered juveniles if their SVL was between 500 - 300mm (Burkett, Ray 1966, Eskew et al. 2009), and young of the year (YOY) were considered to be individuals less than 300mm SVL (Koons et al. 2009). Body mass was measured with either a spring scale (Pesola) in the field, or by digital balance (Ohaus) in the lab. 

Habitat selection was quantified by recording a suite of biotic and abiotic environmental variables (Table 1) from the location an individual was located prior to capture. A 1-m2 quadrat was used as the scale at which habitat variables were measured. To assess the microhabitats available to the population within the study site to those habitat variables being selected by cottonmouths, a combination of random and fixed sites (habitat sites) were measured. A randomly chosen comparison site was paired with each snake location, and sites were selected by using the random points tool in ArcMap within the boundary area. Fixed sites were placed 200-m in relation to one another within the boundary area, using the Fishnet tool in ArcMap, to assure all available habitats were quantified. 

## Multivariate Analysis 

To test that cottonmouth habitat selected was different then general habitat available a Permutational Multivariate Analysis of Variance (PERMANOVA) on Euclidean distance was performed (Anderson 2017). PERMANOVA tests for discrimination of groups within multivariate space, and a significant p-value (<0.05) indicates that groups differ due to their distances between centroid locations, their relative dispersion, or both (Anderson 2017). The advantages of PERMANOVA are that it does not assume normality and homogeneity of variance (Delgado-Baquerizo et al. 2015). Permutational analysis of multivariate dispersion (PERMDISP) tests for homogeneity of multivariate dispersion among groups, and is used to distinguish if dispersion is causing a significant PERMANOVA(Assis et al. 2013, Anderson 2017, Brückner and Heethoff 2017). A significant p-value from PERMDISP indicates that multivariate dispersion is heterogeneous between groups (Anderson 2017). PERMANOVA/PERMDISP were computed in R using the vegan package (Oksanen et al. 2019). To visualize the differences between cottonmouth habitat and general habitat, and aid in interpretation of the PERMANOVA/PERMDISP results, a Principal Component Analysis (PCA) on correlations was used. PCA helps to reduce dimensionality of a large dataset by extracting the most contributing variables that explain the variation within each dimension, and rank components based on explained variance (Peres-Neto et al. 2003). Prior to PCA, habitat variables were scaled (Kassambara 2017), and the first two components were retained for better visual representation. PCA was performed using the R packages FactoMiner and FactoExtra (Kassambara 2017).  

To test for habitat selection differences between cottonmouth groups (Males, Females, Juveniles and YOY) PERMANOVA/PERMDISP and PCA were used. A pairwise comparison of PERMANOVA was used to identify differences between each group (Herve 2019). To evaluate the presence of an ontogenetic difference in overall habitat use among cottonmouths, linear regression was used to compare snake SVL and principal component one, similar to Eskew et al. 2009. 

## Random Forest  

Random forest (RF) classification approach (Breiman 2001) was used to identify the important habitat variables that discriminate between cottonmouth selected habitat and general habitat available. RF is a nonparametric classification method that builds an ensemble of thousands of classification trees from predictive variables and optimizes the accuracy of each tree. For each tree, a bootstrap sample of approximately 64% (i.e., bag sample) is used as a training set, and the remaining data left out is used as a validation set (i.e., out-of-bag [OOB]) to the finished tree as a cross-validation method (Breiman 2001, Severson et al. 2017). RF uses all trees to predict and estimate the overall OOB error rate. RF classifiers are resistant to collinearity of covariates, do not assume independence of samples, model nonlinear relationships, and are known to be more accurate models with ecological data compared to general statistical (ex: logistical regression) (Breiman 2001, Cutler et al. 2007, Severson et al. 2017).  However, multi-collinearity can reduce interpretations of results (Murphy et al. 2010). Before model construction, multi-collinearity in the predictors were assessed using qr matrix decomposition (threshold = 0.05) using the rfUtilities package (Evans and Murphy 2019). Using the randomForest function, from the randomForest package (Breiman et al. 2018), 1,000 classification trees were applied to each model. To construct an optimal model classifying cottonmouth and general habitat from the collected habitat variables, 30 iterations of a 10-fold cross-validation training set were ran, and a mean RF model was calculated. The cross-validation test set was then used to calculate a mean error rate and identify a minimal error rate model (Severson et al. 2017). The minimal error rate model was used to calculate relative importance and create partial dependence plots of the top 4 most contributing predictive habitat variables used to discriminate groups in the final model. 

# Results

## Multivariate Analysis

## PCA 1

**Cottonmouth habitat compared to general available habitat.**

```{r Snake Vs. Random PCA, include=FALSE}
s<-read.csv("data/RegressionTree.csv")
s<-na.omit(s)
s<-s[,c(1:24)]
glimpse(s)

#Running PC with Whole DataSet
pc<-PCA(s[,1:24], quali.sup = 1, scale.unit = T)
```
 
```{r Variable Contribution for PCA1, fig.width= 10}
a<-fviz_contrib(pc, choice = "var", axes = 1, )
b<-fviz_contrib(pc, choice = "var", axes = 2)
grid.arrange(a,b, ncol = 2)
```
**Figure 1:**: Variable contribution for the suite of habitat variables measured for PCA1. On the left are the variables that contribute to dimension 1, and the right figure are the variables that contribute to dimension 2.

```{r PCA1, echo=TRUE}
x<-fviz_pca_biplot(pc, col.ind = s$Type, palette = c("Blue", "Red"), legend.title = "Type",label = "var",col.var = "black",select.var = list(cos2=0.5), addEllipses = T,repel = T,ggtheme = theme_bw())
x
```
**Figure 2:**: The Principal component analysis for the cottonmouth (snake) habitats selected compared to the general habitat that was measured.

## PERMANOVA 1


```{r PERMANOVA Test}
adonis(s[,2:24]~ Type, data = s, method='eu')
```

## PERMDISP 1

PERMDISP is a test for PERMANOVA to check if there is heterogeneity of dispersion between groups.
```{r Permadisp}
#PERMDISP
dist<-vegdist(s[,2:24])
bd<-anova(betadisper(dist,s$Type))
bd #Does not meet the assumption of homogeneity of multivariate dispersion there its heterogeneity of multivariate dispersion.
```

## PCA 2 

Principal component analysis was used to assess the relationship of the continuous habitat variables that explain the relationship among the cottonmouth habitat selected within groups (Males, Females, Juveniles, YOY).

```{r PCA, include=FALSE}
s<-read.csv("data/Cottonmouth10-10_SVL.csv")
s<-s[,c(2,6:28)]
s<-na.omit(s)
pc<-PCA(s[,1:24], quali.sup = 1, scale.unit = T)
```

```{r Contributing variables, fig.width= 10}
a1<-fviz_contrib(pc, choice = "var", axes = 1)
b1<-fviz_contrib(pc, choice = "var", axes = 2)
grid.arrange(a1,b1, ncol = 2)
```
**Figure 3:**: Variable contribution for the suite of habitat variables measured for PCA2. On the left are the variables that contribute to dimension 1, and the right figure are the variables that contribute to dimension 2.

```{r PCA 2}
fviz_pca_biplot(pc, col.ind = s$Type, palette = "jco", label = "var", col.var = "black",select.var = list(cos2=0.5),legend.title = "Group", addEllipses = T,repel = T,ggtheme = theme_bw())
```
**Figure 4:** Principal component analysis of the relationship of the habitat variables among the cottonmouth groups (Female, Juvenile, Male, & YOY). (YOY = young of the year). 

## PERMANOVA 2

```{r PERMANOVA 2, echo=TRUE}
adonis(s[,2:24]~ Type, data = s, method='eu')
```

## PERMDISP 2
```{r PERMDISP 2}
dist<-vegdist(s[,2:24])
bd<-anova(betadisper(dist,s$Type))
bd
```

## Pairwise Analysis 2
```{r Pairwise comparision within groups}
pairwise.perm.manova(vegdist(s[,2:24]), s$Type, nperm = 999, test = "Hotelling-Lawley")
```
## Linear Regression


```{r Regression Line, echo=FALSE}
s1<-read.csv("data/Cottonmouth10-10_SVL.csv")
s1<-na.omit(s1)
pc2<- princomp(s[,-1], cor = T, scores = T)
PCA2<-cbind(s1, pc2$scores[,1:3])
lm<-lm(SVL~Comp.1, PCA2)
summary(lm)

ggplot(PCA2, aes(x= SVL, y= Comp.1))+
  geom_point(size = 2)+
  xlim(209, 1061)+
  geom_smooth(method = "lm", color= "black")+
  geom_hline(yintercept = 0, lty = 2) +
  geom_vline(xintercept = 600, lty = 2)+
  theme_bw(base_size = 24)+
  geom_text(aes(260, -3, label = paste("R^2 = 0.071 ")), color="black")+
  geom_text(aes(240, -3.6, label = paste("p < 0.01")), color = "black")+
  xlab("Snout-vent length (mm)")+
  ylab("Dim1 (20.3%)")

```
**Figure 5:** Comparision of princical component 1 of PCA 2 with SVL. 

# References:

**FactoMiner & FactoExtra** 

Kassambara, A. 2017. Practical Guide to Principal Component Methods in R. STHDA.

**randomForest & randomForestExplainer** 

Breiman, L. & Cutler, A. 2018. Breiman and Cutler's Random Forests for Classification and Regression. CRAN.

**vegan**

Oksanen, J., Guillaume Blanchet, F., Kindt, R., Legendre, P., McGlinn, D., Minchin, P., O'Hara, R.B., Simpson, G., Solymos, P., Henry, M., Stevens, H., Szoecs, E., Wagner, H. 2019. Community Ecology Package. CRAN.
