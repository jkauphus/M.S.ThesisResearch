---
title: Habitat Selection by Cottonmouths (Agkistrodon piscivorus) in Middle Tennessee.-
  Preliminary Anlysis
author: "Jack Kauphusman"
date: "10/23/2019"
output:
  html_notebook:
    df_print: paged
    highlight: breezedark
    number_sections: yes
    rows.print: 10
    theme: cosmo
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  html_document:
    df_print: paged
    toc: yes
  pdf_document: default
editor_options:
  chunk_output_type: inline
---
<style type="text/css">

h1.title {
  font-size: 40px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}
h4.author { /* Header 4 - and the author and data headers use this too  */
  font-size: 20px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}
</style>
---


```{r Library, include=FALSE}
library("dplyr")
library("ggplot2")
library("factoextra")
library("FactoMineR")
library("tidyr")
library("knitr")
library("gridExtra")
library(lattice)
library(permute)
library(vegan)
library(RVAideMemoire)
library(MASS)
library(caret)
library(tmap)
library(tmaptools)
library("ggsn")
library("leaflet")
library("mapdata")
library("maptools")
library("rgdal")
library("smoothr")
library("sf")
library("sp")
library(ggmap)
library("tidyverse")
library("randomForest")
library("randomForestExplainer")
library("rfUtilities")
library(faraway)
library(ROCR)
library(formattable)
library(kableExtra)
```

# Methods

## Study Area 

Data was collected along the Cumberland River Bicentennial Trail (CRBT), Cheatham County, Tennessee, USA (36˚17’ N, 87˚05’W). A boundary of an 115ha area was constructed using ArcMap (ESRI Products) to be used as the focal study area and the habitats within to be assessed. The trail was included within the boundary and divided the mixed lowland forest and slough wetlands from the upland limestone bluffs and rocky outcrops. Cottonmouths used the upland forest and limestone bluffs as overwintering sites and occupied the lowland forest slough during the active season. The landscape features that bordered the study area were the limestone bluffs and backwater streams along the northern portions, the Cumberland River along the west and south, and crop fields and urban development along the southern portions. These landscape features appeared to isolate this population of cottonmouths from dispersal. Unpublished telemetry data (Smith 2009) noted that snakes did not leave the study area, however, an adult male was observed attempting to cross a road toward the Cumberland River but was unfortunately killed by a passing vehicle.  

The habitat types found within the study area are the buttonbush slough in the central portion (xx ha), characterized by relatively open canopy, deeper water (50-150 cm), and mats of floating vegetation (Hydrocotyle ranunculoides & Ludwigia palustris) scattered throughout the slough. An open water habitat (> 100cm) is located toward the western portion of the study area. The seasonally flooded lowland forest (xx ha), dominated by red maples (Acer rubrum), has the denser canopy closure for the wetland, and is located between the slough and upland forest. Toward the southern portion between the slough and crop fields is a transitional edge area (xx ha) dominated by dense grass vegetation and occasionally floods (<10cm) in some portions throughout the year.  The upland forest habitat (xx ha) was dominated by oak trees (Quercus sp.) and had dense canopy closure and higher percentage of bare soil. Three main streams flow into the slough from the upland forest and provide a permanent source of water to the slough, along with periodic flooding from the Cumberland River, and groundwater seepage. A constructed levee divides the slough from adjacent crop fields, and during the fall waterfowl hunt, a culvert is opened from the levee to reduce the flooded areas.  

```{r Field Map, echo=TRUE, message=FALSE, warning=FALSE}
#Outmap
state <- map_data("state")
county <- map_data("county")
study_site <- data.frame("x" = -87.092447, "y" = 36.288684)
tn <- county %>% 
  filter(region=="tennessee")

Cheatham <- county %>% 
  filter(region=="tennessee") %>% 
  filter(subregion=="cheatham")

a1<-ggplot() + geom_polygon(data = state, aes(x=long, y = lat, group = group),
                        fill = "white", color="black") + 
           geom_polygon(data = tn, aes(x=long, y = lat, group = group),
                        fill = "gray", color="black") + 
           geom_polygon(data = Cheatham, aes(x=long, y = lat, group = group),
                        fill = "yellow", color="black") + 
           geom_point(data = study_site, aes(x=x,y=y), color="black") +
  coord_fixed(xlim = c(-91, -81),  ylim = c(34, 37), ratio = 1.2) + 
  xlab("Longitude") + ylab("Latitude") + ggtitle("Cheatham Co., TN")
```

```{r Files, include=FALSE}
#Using ggspatial
library(ggspatial)
library(rosm)

#Shapefiles
generalhab<-st_read("data/Habitat/GENERALHABITAT.shp")
Boundary<-st_read("data/Habitat/GENRLHABI.shp")
cottonmouths<-st_read("data/Habitat/Cottonmouths.shp")
```


```{r Study Site Static, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE}
#Map
b<-ggplot()+
  annotation_map_tile(type = "thunderforestlandscape")+
  annotation_scale(location = "bl")+
  geom_sf(data = Boundary,size = 1, col = "red", fill = NA, show.legend = "line")+
  geom_sf(data = cottonmouths, aes(fill = "Cottonmouth Location"),col = "purple",size = 1.5, show.legend = "point")+
  labs(fill = 'Legend', title = "Study Site")
grid.arrange(a1,b, ncol=1)
```
**Map 1:** Above, location of the study site along a swamp adjacent to The Cumberland River Bicentennial Trail, Cheatham County, TN, USA. Below,is the zoomed in view of the study area. The boundary line, where collection took place, is colored in red, and the cottonmouth locations were symbolized as green points. 

```{r Study Site, echo=TRUE, message=FALSE, warning=FALSE}
a<-tmap_mode("view")+
tm_shape(Boundary)+
  tm_borders(col= "red", lwd = 1)+
  tm_shape(cottonmouths)+
  tm_dots(col = "purple", size = 0.05, id = "NAME", text = "Cottonmouth location")+
  tm_scale_bar()+
  tm_layout("Study Site", legend.show = T)+
  tm_basemap(leaflet::providers$Esri.WorldImagery)
a
```
**Map 2:** The interactive map of the study area, made using the tmap package.


## Field Collection 

Visual encounter surveys occurred during the active seasons (May – October) of 2012, 2013, and 2019. Snakes were captured using snake tongs and retained in plastic restraining tubes (Midwest Tongs).  For individual identification, each snake was implanted subcutaneously with a Passive Integrated Transponder (PIT) tag (Biomark) on the posterior to the ventral side of the midbody. Tags and implant syringes were soaked in Benzalkonium Chloride (Benz-all) for 2 – 3 minutes prior to tag implantation, and an antiseptic liquid bandage (Vetclose) was applied to the insertion area to facilitate healing. Snout-vent length (SVL) and tail lengths (TL) were measured, and snakes were sexed by either everting hemipenes or by probing (Blanchard, F and Finister, E 1933) Individuals were considered juveniles if their SVL was between 500 - 300mm (Burkett, Ray 1966, Eskew et al. 2009), and young of the year (YOY) were considered to be individuals less than 300mm SVL (Koons et al. 2009). Body mass was measured with either a spring scale (Pesola) in the field, or by digital balance (Ohaus) in the lab. 

Habitat selection was quantified by recording a suite of biotic and abiotic environmental variables (Table 1) from the location an individual was located prior to capture. A 1-m2 quadrat was used as the scale at which habitat variables were measured. To assess the microhabitats available to the population within the study site to those habitat variables being selected by cottonmouths, a combination of random and fixed sites (habitat sites) were measured. A randomly chosen comparison site was paired with each snake location, and sites were selected by using the random points tool in ArcMap within the boundary area. Fixed sites were placed 200-m in relation to one another within the boundary area, using the Fishnet tool in ArcMap, to assure all available habitats were quantified. 

## Multivariate Analysis 

To test that cottonmouth habitat selected was different then general habitat available a Permutational Multivariate Analysis of Variance (PERMANOVA) on Euclidean distance was performed (Anderson 2017). PERMANOVA tests for discrimination of groups within multivariate space, and a significant p-value (<0.05) indicates that groups differ due to their distances between centroid locations, their relative dispersion, or both (Anderson 2017). The advantages of PERMANOVA are that it does not assume normality and homogeneity of variance (Delgado-Baquerizo et al. 2015). Permutational analysis of multivariate dispersion (PERMDISP) tests for homogeneity of multivariate dispersion among groups, and is used to distinguish if dispersion is causing a significant PERMANOVA(Assis et al. 2013, Anderson 2017, Brückner and Heethoff 2017). A significant p-value from PERMDISP indicates that multivariate dispersion is heterogeneous between groups (Anderson 2017). PERMANOVA/PERMDISP were computed in R using the vegan package (Oksanen et al. 2019). To visualize the differences between cottonmouth habitat and general habitat, and aid in interpretation of the PERMANOVA/PERMDISP results, a Principal Component Analysis (PCA) on correlations was used. PCA helps to reduce dimensionality of a large dataset by extracting the most contributing variables that explain the variation within each dimension, and rank components based on explained variance (Peres-Neto et al. 2003). Prior to PCA, habitat variables were scaled (Kassambara 2017), and the first two components were retained for better visual representation. PCA was performed using the R packages FactoMiner and FactoExtra (Kassambara 2017).  

To test for habitat selection differences between cottonmouth groups (Males, Females, Juveniles and YOY) PERMANOVA/PERMDISP and PCA were used. A pairwise comparison of PERMANOVA was used to identify differences between each group (Herve 2019). To evaluate the presence of an ontogenetic difference in overall habitat use among cottonmouths, linear regression was used to compare snake SVL and principal component one, similar to Eskew et al. 2009. 

## Random Forest  

Random forest (RF) classification approach (Breiman 2001) was used to identify the important habitat variables that discriminate between cottonmouth selected habitat and general habitat available. RF is a nonparametric classification method that builds an ensemble of thousands of classification trees from predictive variables and optimizes the accuracy of each tree. For each tree, a bootstrap sample of approximately 64% (i.e., bag sample) is used as a training set, and the remaining data left out is used as a validation set (i.e., out-of-bag [OOB]) to the finished tree as a cross-validation method (Breiman 2001, Severson et al. 2017). RF uses all trees to predict and estimate the overall OOB error rate. RF classifiers are resistant to collinearity of covariates, do not assume independence of samples, model nonlinear relationships, and are known to be more accurate models with ecological data compared to general statistical (ex: logistical regression) (Breiman 2001, Cutler et al. 2007, Severson et al. 2017).  However, multi-collinearity can reduce interpretations of results (Murphy et al. 2010). Before model construction, multi-collinearity in the predictors were assessed using qr matrix decomposition (threshold = 0.05) using the rfUtilities package (Evans and Murphy 2019). Using the randomForest function, from the randomForest package (Breiman et al. 2018), 1,000 classification trees were applied to each model. To construct an optimal model classifying cottonmouth and general habitat from the collected habitat variables, 30 iterations of a 10-fold cross-validation training set were ran, and a mean RF model was calculated. The cross-validation test set was then used to calculate a mean error rate and identify a minimal error rate model (Severson et al. 2017). The minimal error rate model was used to calculate relative importance and create partial dependence plots of the top 4 most contributing predictive habitat variables used to discriminate groups in the final model. 

# Results

```{r General Stats, include=FALSE}
s<-read.csv("data/snake.SVL.csv")
s<-na.omit(s)
s<-s[,2:28]
#How Many snakes (in groups) and general habitat variables measured

Female<-tabulate(s$Type)[1]
Juvenile<-tabulate(s$Type)[2]
Male<-tabulate(s$Type)[3]
YOY<-tabulate(s$Type)[4]
Snake<- Female+Juvenile+Male+YOY

sg<-sg<-read.csv("data/HabitatSel.csv")
General<-tabulate(sg$Type)[1]

#SVL 

SVL<-group_by(s, Type)%>%
  summarise(
    mean=mean(SVL, na.rm = T)
  )
SVl.SD<- group_by(s, Type)%>%
  summarise(
    sd=sd(SVL, na.rm = T)
  )

```

From May - October  of 2012, 2013, and 2019, we recorded habitat variables for `r Snake` cottonmouths and `r General` general habitat comparison sites. Of the cottonmouths that were captured, `r Male` were adult males, `r Female` adult females, `r Juvenile` juveniles, and `r YOY` YOY. Adult males averaged in **(744 +/-132)**mm in SVL, females **(620 +/- 60)**mm, juveniles **(408 +/- 55)**mm, and YOY **(251 +/- 24)**.  

## Cottonmouth Habitat Compared To General Habitat.

We found that cottonmouth habitat selection significantly differed from general habitat available to the cottonmouths within the study area (PERMANOVA; P< 0.001; Pseudo-F = 19.9; d.f. = 1; Table 1). The PERMDISP test found that there was equal dispersion between groups(PERMDISP; P=0.17; F = 1.90; Table 1), thus differences between the groups was due to differences between the mean locations of groups in multivariate space. The Principal component analysis (PCA-1) comparing cottonmouth habitat compared to general habitat explained 30.3% of the variation within dimensions one and two. The most contributing variables within each dimension in PCA-1, were Percent Land (19%), Percent Water (19%), Distance to Water (13%), and Water Depth (13%) within dimension 1, and Ambient Temp (24%), Surface Temp (26%), and Substrate Temp (20%) within dimension 2 (Fig 1a). The results of PCA1 show that cottonmouth habitat was within the general habitat ellipse (Fig 1a). 

## Habitat Analysis on Cottonmouth Groups

The results from the multivariate analysis investigating habitat selection differences among cottonmouth groups found that there were no significant differences between groups (PERMANOVA; P >0.05; Pseudo-F =1.21; Table 2). There was homogenous distribution of variance between groups present in multivariate space (PERMDISP; P> 0.05, F = 2.15; Table 2). A parwise comparision on the PERMANOVA using Hotelling T-square test identified that there was no significant difference between groups habitat selection. Although, the pairwise comparison of adult males and YOY were close to being significantly different (Pairwise PERMANOVA; P = 0.08). The Principal component analysis (PCA-2) comparing habitat selection among the cottonmouth groups explained  31.1% of the variation within dimensions one and two. Habitat variables with the highest contributions were shared with PCA1. Percent Land (17%) and Percent Water (17%) had the highest contribution to dimension 1, and Ambient Temp (23%), Surface Temp (26%), and Substrate Temp (20%) in dimension 2.

Linear regression of dimension one habitat variables of PCA-2 and body size (SVL) found a significant negative relationship (P <0.01; Fig 2). The linear relationship of dimension one of PCA-2 and body size indicated that larger snakes prefered wetter habitat sites. However, caution must be used in interpreting the results as this relationship had a low explainatory power in dimension one (20%) and R2 (0.02) value.

## Result Tables & Figures

```{r Snake Vs. Random PCA, include=FALSE}
s<-read.csv("data/HabitatSel.csv")
s<-na.omit(s)
s<-s[,c(1:24)]
```

```{r PERMANOVA & PERMDISP Tests}
#PERMANOVA
Perm1<-adonis(s[,2:24]~ Type, data = s, method='eu')
Perm1<-cbind(Perm1$aov.tab[1,4], Perm1$aov.tab[1,6])

#PERMDISP
dist<-vegdist(s[,2:24])
bd<-anova(betadisper(dist,s$Type))
bd1<-cbind(bd$`F value`, bd$`Pr(>F)`)
bd1<-data.frame(bd1)
bd1<-bd1[-2,]

PermDisp<- cbind(Perm1, bd1)
names(PermDisp)<-c("Pseudo-F", "P", "F", "P ")
row.names(PermDisp)<-c("Proportions (Euclidean)")

kable(PermDisp, digits = 3, caption = "Table 1: Results of the multivariate statistal tests PERMANOVA/PERMDISP based on the Euclidean distance comparing cottonmouth habitat selected and general habitat available to the cottonmouth within the study area.")%>%
  kable_styling(c("striped", "bordered"))%>%
  add_header_above(c(" " = 1, "PERMANOVA" = 2, "PERMDISP" = 2))%>%
  footnote(general = "N(permutations) = 999; df = 1")

```


```{r include=FALSE}
#Running PC with Whole DataSet
pc<-PCA(s[,1:23], quali.sup = 1, scale.unit = T)
```

```{r PCA1, include=FALSE}
x<-fviz_pca_biplot(pc,col.ind = s$Type, palette = c("Blue", "Red"), legend.title = "Type",label = "var",col.var = "black",select.var = list(cos2=0.5), addEllipses = T,repel = T,ggtheme = theme_bw())+
  ggtitle("General Vs. Cottonmouth Habitat")

var<-get_pca_var(pc)
var$contrib[,1:2]
```

```{r Perdataset groups, include=FALSE}
s<-read.csv("data/snake.SVL.csv")
s<-s[,c(2,6:28)]
s<-na.omit(s)
```

```{r PERMANOVA 2, fig.width= 12, echo=TRUE}
set.seed(123)
#PERMANOVA
Perm2<-adonis(s[,2:24]~ Type, data = s, method='eu')
Perm2<-cbind(Perm2$aov.tab[1,4], Perm2$aov.tab[1,6])

#PERMDISP 2
dist<-vegdist(s[,2:24])
bd2<-anova(betadisper(dist,s$Type))

bd2<-cbind(bd2$`F value`, bd2$`Pr(>F)`)
bd2<-data.frame(bd2)
bd2<-bd2[-2,]

#Pairwise using Hotelling-Lawley

pairs<-pairwise.perm.manova(vegdist(s[,2:24]), s$Type, nperm = 5000, test = "Hotelling-Lawley")
pairs<-c(pairs$p.value[1,1],pairs$p.value[2,1],pairs$p.value[3,1], pairs$p.value[2,2], pairs$p.value[3,2], pairs$p.value[3,3])
pairs<-t(data.frame(pairs))
PermDisp<- cbind(Perm2, bd2)
PermDisp<-cbind(PermDisp, pairs)
names(PermDisp)<-c("Pseudo-F", "P", "F", "P ","Female/JUV", "Female/Male", "Female/YOY", "Male/JUV", "JUV/YOY", "Male/YOY")
row.names(PermDisp)<-c("Proportions (Euclidean)")

#Kable
kable(PermDisp, digits = 3, caption = "Table 1: Results of the multivariate statistal tests PERMANOVA/PERMDISP based on the Euclidean distance comparing habitat selected differnces among the cottonmouth groups within the study area.")%>%
  kable_styling(c("striped", "bordered"))%>%
  add_header_above(c(" " = 1, "PERMANOVA" = 2, "PERMDISP" = 2, "Pairwise-Comparison" = 6))%>%
  footnote(general = "N(permutations) = 5000; df = 1",
           "JUV = Juvenile",
           "YOY = Young of the year")
```

```{r include=FALSE}
pc<-PCA(s[,1:24], quali.sup = 1, scale.unit = T)
```

```{r include=FALSE}
y<-fviz_pca_biplot(pc, col.ind = s$Type, palette = "jco", label = "var", col.var = "black",select.var = list(cos2=0.5),legend.title = "Group", addEllipses = T,repel = T,ggtheme = theme_bw())+
  ggtitle("Cottonmouth Groups Habitat")
var<-get_pca_var(pc)
var$contrib[,1:2]
```
```{r, fig.height=10, fig.width=30}
grid.arrange(x,y, ncol= 2)
```

**Figure 3:** On the left, principal component analysis for the cottonmouth (snake) habitats selected compared to the general habitat that was measured. The variables with the highest contribution to Dim1 are Percent Land (19%) and Percent Water (19%). The highest contribution to Dim 2 are Ambient Temp (23%), Surface Temp (25%) and Substrate Temp(22%).On the right, principal component analysis on the relationship of the habitat variables among the cottonmouth groups (Female, Juvenile, Male, & YOY)(YOY = young of the year). The variables with the highest contribution were Percent Land (15.7%) and Percent Water (16.2%) in Dim 1, and Ambient Temp (21,4%), Surface Temp (24.2%) and Substrate Temp (16.5%) in Dim2. Ellipses represent 95% CI. 

## Linear Regression

```{r Regression Line, echo=FALSE}
s1<-read.csv("data/snake.SVL.csv")
s1<-na.omit(s1)
pc2<- princomp(s[,-1], cor = T, scores = T)
PCA2<-cbind(s1, pc2$scores[,1:3])
lm<-lm(SVL~Comp.1, PCA2)

ggplot(PCA2, aes(x= SVL, y= Comp.1))+
  geom_point(size = 2, aes(color = Type))+
  xlim(209, 1061)+
  geom_smooth(method = "lm", color= "black")+
  geom_hline(yintercept = 0, lty = 2) +
  geom_vline(xintercept = 600, lty = 2)+
  theme_bw(base_size = 24)+
  geom_text(aes(890, 6, label = paste("R-squared = 0.02")), color="black")+
  geom_text(aes(815, 5.2, label = paste("p < 0.01")), color = "black")+
  xlab("Snout-vent length (mm)")+
  ylab("Dim1 (20.3%)")+
  geom_text(data = NULL, label = "Drier", color= "blue", x =220, y= 7)+
  geom_text(data = NULL, label = "Wetter", color= "blue", x =240, y= -4.85)

```
**Figure 5:** Linear regression of Principal Component scores of PC-1 comparison of habitat selection among the cottonmouth groups (Males, Females, Juveniles, and YOY) and cottonmouth snout-vent lengths. 

## Random Forest Model
```{r randomForest, include=FALSE}
#Loading data
s<-read.csv("data/HabitatSel.csv")
s<-na.omit(s)
s<-s[,c(1:24)]
```

## Multicollinearity with VIF
```{r checking Multicolinearrity}

#OR with VIF
model<-lm(Substrate.Temp~., data = s[,-1])
vif(model)

#From the VIF the X.Land and X.Water have high degree of multicollinearity so I shall remove X.Land
s<-s[,-19] #Removed X.Land
model<-lm(Substrate.Temp~., data = s[,-1])
vif(model)
```

```{r 10-Fold Cross Validation, echo=TRUE}
set.seed(123)
ind<-sample(2,nrow(s),replace = T, prob = c(0.9,0.1))
train<-s[ind==1,]
test<-s[ind==2,]
```

```{r 30 iterations, echo=TRUE}
a1<- randomForest(Type~., data = train, ntree = 1000)
a2<- randomForest(Type~., data = train, ntree = 1000)
a3<- randomForest(Type~., data = train, ntree = 1000)
a4<- randomForest(Type~., data = train, ntree = 1000)
a5<- randomForest(Type~., data = train, ntree = 1000)
a6<- randomForest(Type~., data = train, ntree = 1000)
a7<- randomForest(Type~., data = train, ntree = 1000)
a8<- randomForest(Type~., data = train, ntree = 1000)
a9<- randomForest(Type~., data = train, ntree = 1000)
a10<- randomForest(Type~., data = train, ntree = 1000)
b1<- randomForest(Type~., data = train, ntree = 1000)
b2<- randomForest(Type~., data = train, ntree = 1000)
b3<- randomForest(Type~., data = train, ntree = 1000)
b4<- randomForest(Type~., data = train, ntree = 1000)
b5<- randomForest(Type~., data = train, ntree = 1000)
b6<- randomForest(Type~., data = train, ntree = 1000)
b7<- randomForest(Type~., data = train, ntree = 1000)
b8<- randomForest(Type~., data = train, ntree = 1000)
b9<- randomForest(Type~., data = train, ntree = 1000)
b10<- randomForest(Type~., data = train, ntree = 1000)
c1<- randomForest(Type~., data = train, ntree = 1000)
c2<- randomForest(Type~., data = train, ntree = 1000)
c3<- randomForest(Type~., data = train, ntree = 1000)
c4<- randomForest(Type~., data = train, ntree = 1000)
c5<- randomForest(Type~., data = train, ntree = 1000)
c6<- randomForest(Type~., data = train, ntree = 1000)
c7<- randomForest(Type~., data = train, ntree = 1000)
c8<- randomForest(Type~., data = train, ntree = 1000)
c9<- randomForest(Type~., data = train, ntree = 1000)
c10<- randomForest(Type~., data = train, ntree = 1000)
```

```{r Out-of-Bag}
OOB<-c(a1$err.rate[1000,1],a2$err.rate[1000,1],a3$err.rate[1000,1],a4$err.rate[1000,1],a5$err.rate[1000,1],a6$err.rate[1000,1],
       a7$err.rate[1000,1],a8$err.rate[1000,1],a9$err.rate[1000,1],a10$err.rate[1000,1],b1$err.rate[1000,1],b2$err.rate[1000,1],
       b3$err.rate[1000,1],b4$err.rate[1000,1],b5$err.rate[1000,1],b6$err.rate[1000,1],b7$err.rate[1000,1],b8$err.rate[1000,1],
       b9$err.rate[1000,1],b10$err.rate[1000,1],c1$err.rate[1000,1],c2$err.rate[1000,1],c3$err.rate[1000,1],c4$err.rate[1000,1],
       c5$err.rate[1000,1],c6$err.rate[1000,1],c7$err.rate[1000,1],c8$err.rate[1000,1],c9$err.rate[1000,1],c10$err.rate[1000,1])

OOB<-c(1-min(OOB),1-mean(OOB), 1-max(OOB))
```

```{r Cross Validation}
p1<-predict(a1, test)
cv1<-confusionMatrix(p1, test$Type)
p2<-predict(a2, test)
cv2<-confusionMatrix(p2, test$Type)
p3<-predict(a3, test)
cv3<-confusionMatrix(p3, test$Type)
p4<-predict(a4, test)
cv4<-confusionMatrix(p4, test$Type)
p5<-predict(a5, test)
cv5<-confusionMatrix(p5, test$Type)
p6<-predict(a6, test)
cv6<-confusionMatrix(p6, test$Type)
p7<-predict(a7, test)
cv7<-confusionMatrix(p7, test$Type)
p8<-predict(a8, test)
cv8<-confusionMatrix(p8, test$Type)
p9<-predict(a9, test)
cv9<-confusionMatrix(p9, test$Type)
p10<-predict(a10, test)
cv10<-confusionMatrix(p10, test$Type)
p11<-predict(b1, test)
cv11<-confusionMatrix(p11, test$Type)
p12<-predict(b2, test)
cv12<-confusionMatrix(p12, test$Type)
p13<-predict(b3, test)
cv13<-confusionMatrix(p13, test$Type)
p14<-predict(b4, test)
cv14<-confusionMatrix(p14, test$Type)
p15<-predict(b5, test)
cv15<-confusionMatrix(p15, test$Type)
p16<-predict(b6, test)
cv16<-confusionMatrix(p16, test$Type)
p17<-predict(b7, test)
cv17<-confusionMatrix(p17, test$Type)
p18<-predict(b8, test)
cv18<-confusionMatrix(p18, test$Type)
p19<-predict(b9, test)
cv19<-confusionMatrix(p19, test$Type)
p20<-predict(b10, test)
cv20<-confusionMatrix(p20, test$Type)
p21<-predict(c1, test)
cv21<-confusionMatrix(p21, test$Type)
p22<-predict(c2, test)
cv22<-confusionMatrix(p22, test$Type)
p23<-predict(c3, test)
cv23<-confusionMatrix(p23, test$Type)
p24<-predict(c4, test)
cv24<-confusionMatrix(p24, test$Type)
p25<-predict(c5, test)
cv25<-confusionMatrix(p25, test$Type)
p26<-predict(c6, test)
cv26<-confusionMatrix(p26, test$Type)
p27<-predict(c7, test)
cv27<-confusionMatrix(p27, test$Type)
p28<-predict(c8, test)
cv28<-confusionMatrix(p28, test$Type)
p29<-predict(c9, test)
cv29<-confusionMatrix(p29, test$Type)
p30<-predict(c10, test)
cv30<-confusionMatrix(p30, test$Type)
#Creating CV Table
CVTABLE<-t(data.frame(cv1$overall,cv2$overall,cv3$overall,cv4$overall,cv5$overall,cv6$overall,
                        cv7$overall,cv8$overall,cv9$overall,cv10$overall,cv11$overall,cv12$overall,
                        cv13$overall,cv14$overall,cv15$overall,cv16$overall,cv17$overall,cv18$overall,
                        cv19$overall,cv20$overall,cv21$overall,cv22$overall,cv23$overall,cv24$overall,
                        cv25$overall,cv26$overall,cv27$overall,cv28$overall,cv29$overall,cv30$overall))


CV2TABLE<-t(data.frame(cv1$byClass,cv2$byClass,cv3$byClass,cv4$byClass,cv5$byClass,cv6$byClass,
                        cv7$byClass,cv8$byClass,cv9$byClass,cv10$byClass,cv11$byClass,cv12$byClass,
                        cv13$byClass,cv14$byClass,cv15$byClass,cv16$byClass,cv17$byClass,cv18$byClass,
                        cv19$byClass,cv20$byClass,cv21$byClass,cv22$byClass,cv23$byClass,cv24$byClass,
                        cv25$byClass,cv26$byClass,cv27$byClass,cv28$byClass,cv29$byClass,cv30$byClass))

cv_table<-data.frame(CVTABLE,CV2TABLE)
cv_table<-cv_table[,c(1,2,8,9)]

cv_max<-c(max(cv_table[,1]), max(cv_table[,2]), max(cv_table[,3]), max(cv_table[,4]))
cv_mean<-c(mean(cv_table[,1]), mean(cv_table[,2]), mean(cv_table[,3]), mean(cv_table[,4]))
cv_min<-c(min(cv_table[,1]), min(cv_table[,2]), min(cv_table[,3]), min(cv_table[,4]))

cv_table<-data.frame(rbind(cv_max,cv_mean, cv_min))

RandomForest_Model<-c("Maximum", "Mean", "Minimum")
```


```{r Calculating AUC}
#Minimal Model AUC
pred1<-predict(c1, test, type = "prob")
pred1<-pred1[,2]
pred1<-prediction(pred1, test$Type)

#AUC (Area Under The Curve)
auc1<-performance(pred1, "auc")
auc1<-unlist(slot(auc1, "y.values"))
min_auc<-round(auc1, 4)


#Mean Model AUC
pred1<-predict(a8, test, type = "prob")
pred1<-pred1[,2]
pred1<-prediction(pred1, test$Type)

#AUC (Area Under The Curve)
auc1<-performance(pred1, "auc")
auc1<-unlist(slot(auc1, "y.values"))
mean_auc<-round(auc1, 4)


#Mean Model AUC
pred1<-predict(a1, test, type = "prob")
pred1<-pred1[,2]
pred1<-prediction(pred1, test$Type)

#AUC (Area Under The Curve)
auc1<-performance(pred1, "auc")
auc1<-unlist(slot(auc1, "y.values"))
max_auc<-round(auc1, 4)

AUC<-c(min_auc, mean_auc, max_auc)
```

```{r Table}
models<-cbind(RandomForest_Model, cv_table, OOB, AUC)

formattable(models, row.names = F, digits = 3, caption= 'Table 1: Performance metrics for the 30-iteration random forest model on cottonmouth habitat selection compared to general habitat available (OOB = Out of Bag accuracy rate, AUC = Area Under the Curve)', align = "l", col.names=c("Random Forest Model", "Accuracy", "Kappa", "Sensitivity", "Specificity", "OOB", "AUC"))
```

```{r Variable Importance, include=FALSE}
#Maximal Model was a3 in the iterations, so I will now use that to create the partial - least square biplots of the top 4 most contributing variables,

D<-varImpPlot(a1,            
           sort = T,
           n.var = 10, type = 2, plot = F)
Gini<-D[,1]
Gini<-data.frame(Gini)
Habitat_Variables <- c("Substrate Temp","Surface Temp", "Ambient Temp","Cover Length", "Cover Width", "Canopy Closure", "Rock Cover", "Leaf Cover", "Vegetative Cover", "Fallen Log Cover", "Woody Stem Diameter","Woody Stem Height", "Cover Height", "Distance To Cover","Log Diameter", "Distance To Water", "Water Depth", "Percent Water", "Percent Woody Debris", "Percent Debris", "Percent Floating Vegetation", "Percent Bare Soil")
D<-cbind(Habitat_Variables,Gini)

G<-ggplot(D, aes( x = reorder(Habitat_Variables, Gini), y=Gini))+
  geom_col(width = .4)+
  ylim(0,25)+
  coord_flip()+
  xlab("Habitat Variables")+
  ylab("Mean decrease in Gini")
  

#Partial Dependence Plot
w<-partialPlot(a1, train, Dist..To.Water, "SNAKE", plot = F)
x<-partialPlot(a1, train, Depth, "SNAKE", plot = F)
y<-partialPlot(a1, train, X.Water, "SNAKE", plot = F)
z<-partialPlot(a1, train, X.Bare.soil, "SNAKE", plot =F)

#Distance to Water
w<-cbind(w$x,w$y)
w<-data.frame(w)
names(w)<-c("x","y")

w1<-ggplot(data = w, aes(x,y))+
  geom_line()+
  xlab("Distance to Water (cm)")+
  ylab("Relative probability")+
  geom_text(aes(4500,0.35), label = paste("A"), col = "black")+
  ylim(-0.8, 0.6)+
  xlim(0,1000)+
  theme_bw()

#Depth

x<-cbind(x$x,x$y)
x<-data.frame(x)
names(x)<-c("x","y")

x1<-ggplot(data = x, aes(x,y))+
  geom_line()+
  xlab("Depth (cm)")+
  ylab("Relative probability")+
  geom_text(aes(80,0.35), label = paste("B"), col = "black")+
  theme_bw()
#X. Bares Soil
y<-cbind(y$x,y$y)
y<-data.frame(y)
names(y)<-c("x","y")

y1<-ggplot(data = y, aes(x,y))+
  geom_line()+
  xlab("Water Cover (%)")+
  ylab("Relative probability")+
  geom_text(aes(100,0.6), label = paste("C"), col = "black")+
  theme_bw()

z<-cbind(z$x,z$y)
z<-data.frame(z)
names(z)<-c("x","y")

z1<-ggplot(data = z, aes(x,y))+
  geom_line()+
  xlab("Bare Soil (%)")+
  ylab("Relative probability")+
  geom_text(aes(100, 0.3), label = paste("D"), col = "black")+
  theme_bw()
```

```{r Variable importance Plot}
G
```
**Figure #:**The Mean decrease in Gini, a metric for variable importance, on the habitat variables from the Minimum Random Forest model of Cottonmouth (Agkistrodon piscivorus) habitat selection in Middle TN, USA. Cover variables were measured in percentage of occurance within a 1-m^2 quadrat, and all other metrics were measured in cm.

```{r Partial Dependance Plots}
grid.arrange(x1,w1,y1,z1, ncol= 2)
```
**Figure #:** Partial dependance plots of the four most constributing variables (From mean decrease in gini) with relative probability of cottonmouth habitat selection of a site within Middle Tennessee, USA. Distance to water (A), water depth (B), percent bare soil (C), and surface temperature (D) were measured within a 1-m^2 quadrat from were a cottonmouth was located during visual encounter.

# Discussion

# References:

**FactoMiner & FactoExtra** 

Kassambara, A. 2017. Practical Guide to Principal Component Methods in R. STHDA.

**randomForest & randomForestExplainer** 

Breiman, L. & Cutler, A. 2018. Breiman and Cutler's Random Forests for Classification and Regression. CRAN.

**vegan**

Oksanen, J., Guillaume Blanchet, F., Kindt, R., Legendre, P., McGlinn, D., Minchin, P., O'Hara, R.B., Simpson, G., Solymos, P., Henry, M., Stevens, H., Szoecs, E., Wagner, H. 2019. Community Ecology Package. CRAN.
